 <!DOCTYPE html>
<html class="no-js">
    <head>
        <!-- Basic Page Needs
        ================================================== -->
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <link rel="icon" type="image/png" href="images/favicon.png">
        <title>Timer Agency Template</title>
        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="author" content="">
        <!-- Mobile Specific Metas
        ================================================== -->
        <meta name="format-detection" content="telephone=no">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <!-- Template CSS Files
        ================================================== -->
        <!-- Twitter Bootstrs CSS -->
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <!-- Ionicons Fonts Css -->
        <link rel="stylesheet" href="css/ionicons.min.css">
        <!-- animate css -->
        <link rel="stylesheet" href="css/animate.css">
        <!-- Hero area slider css-->
        <link rel="stylesheet" href="css/slider.css">
        <!-- owl craousel css -->
        <link rel="stylesheet" href="css/owl.carousel.css">
        <link rel="stylesheet" href="css/owl.theme.css">
        <link rel="stylesheet" href="css/jquery.fancybox.css">
        <!-- template main css file -->
        <link rel="stylesheet" href="css/main.css">
        <!-- responsive css -->
        <link rel="stylesheet" href="css/responsive.css">
        
        <!-- Template Javascript Files
        ================================================== -->
        <!-- modernizr js -->
        <script src="js/vendor/modernizr-2.6.2.min.js"></script>
        <!-- jquery -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <!-- owl carouserl js -->
        <script src="js/owl.carousel.min.js"></script>
        <!-- bootstrap js -->

        <script src="js/bootstrap.min.js"></script>
        <!-- wow js -->
        <script src="js/wow.min.js"></script>
        <!-- slider js -->
        <script src="js/slider.js"></script>
        <script src="js/jquery.fancybox.js"></script>
        <!-- template main js -->
        <script src="js/main.js"></script>
    </head>
    <body>
        
        <!--
        ==================================================
        Header Section Start
        ================================================== -->
        <header id="top-bar" class="navbar-fixed-top animated-header">
            <div class="container">
                <div class="navbar-header">
                    <!-- responsive nav button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <!-- /responsive nav button -->
                    
                    <!-- logo -->
                    <div class="navbar-brand">
                        <a href="index.html" >
                            <img src="images/logo.png" alt="">
                        </a>
                    </div>
                    <!-- /logo -->
                </div>
                <!-- main menu -->
                <nav class="collapse navbar-collapse navbar-right" role="navigation">
                    <div class="main-menu">
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <a href="index.html" >Home</a>
                            </li>
                             <li><a href="product.html">Product</a></li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <span class="caret"></span></a>
                                <div class="dropdown-menu">
                                    <ul>
                                        <li><a href="about.html">Company</a></li>
                                        <li><a href="gallery.html">OBDII database</a></li>
                                         <li><a href="gallery.html">Privacy&Legal</a></li>
                                    </ul>
                           
                            <li><a href="blog.html">Blog</a></li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Careers <span class="caret"></span></a>
                                <div class="dropdown-menu">
                                    <ul>
                                        <li><a href="ourteam.html">Our Team</a></li>
                                        <li><a href="application.html">Application</a></li>
                                    </ul>
                            <li><a href="contact.html">Contact</a></li>
                            </ul>
                                </div>
                       
                      </div>
                               </div>
                </nav>
                <!-- /main nav -->
            </div>
        </header>

        <!-- 
        ================================================== 
            Global Page Section Start
        ================================================== -->
        <section class="global-page-header">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="block">
                            <h2>CleverDRIVE Database</h2>
                            <div class="portfolio-meta">
                       
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <center>    <div id="fb-root"></div>
		<button id="login">Login</button>
    <h3>CleverDRIVE DB</h3>
                <p>
                    Make: <input id="makeValue" type="text" /><br /></p>
                <p>
                Model:<input id="modelValue" type="text" /><br /></p>
                <p>
                Year: <input id="yearValue" type="text" /><br /></p>
                
    <button id = "Query">Query</button>

    <p id = "putResults"></p>

    <p id ="QueryResults"></p>
    <p id ="fbLoginResults"></p>
       </center>
            </section><!--/#Page header-->
     
        <!--
        ==================================================
        Footer Section Start
        ================================================== -->
        <footer id="footer">
                <div class="container">
                    <div class="col-md-8">
                        <p class="copyright">Copyright: <span>2016</span> . Design and Developed by <a href="http://www.google.com">CleverDRIVE</a></span></p>
                    </div>
                    <div class="col-md-4">
                        <!-- Social Media -->
                        <ul class="social">
                            <li>
                                <a href="http://wwww.google.com" class="Facebook">
                                    <i class="ion-social-facebook"></i>
                                </a>
                            </li>
                            <li>
                                <a href="http://wwww.google.com" class="Twitter">
                                    <i class="ion-social-twitter"></i>
                                </a>
                            </li>
                            <li>
                                <a href="http://wwww.google.com" class="Linkedin">
                                    <i class="ion-social-linkedin"></i>
                                </a>
                            </li>
                            <li>
                                <a href="http://wwww.google.com" class="Google Plus">
                                    <i class="ion-social-googleplus"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
    

    <script type="text/javascript">
        var sessionid = new Date();
        sessionid = sessionid.toString();
        var fbUserId;
        var params;
        var params1;
        var keyText;
        var attText;
        var valText;
        var makeText;
        var modelText;
        var yearText;
        var dynamodb = null;
        var docClient = null;
        var appId = '339491186384703';
                     //from facebook
        var roleArn = 'arn:aws:iam::226612137088:role/bennettsRole'; //from AWS IAM
        var resultData = null;

        
        
        
document.getElementById('Query').onclick = function ()
        {
    dynamodb = new AWS.DynamoDB({ region: 'us-west-2' });
    makeText = document.getElementById("makeValue").value;
        smakeText = makeText.substring(0, 3)
        modelText = document.getElementById("modelValue").value;
        smodelText = modelText.substring(0, 3)
        yearText = document.getElementById("yearValue").value;
        syearText = yearText.substring(0, 4)
        keyText = smakeText + smodelText + syearText;
    //keyText = document.getElementById("keyValue").value;
    docClient = new AWS.DynamoDB.DocumentClient({ service: dynamodb });
    var params = {
    TableName : "cleverTable",
    KeyConditionExpression: "#a = :v",
    ExpressionAttributeNames:{
        "#a": "uniquevehicleID"
    },
    ExpressionAttributeValues: {
        ":v":keyText
    }
      
};

docClient.query(params, function(err, data) {
    if (err) {
        console.error("Unable to query. Error:", JSON.stringify(err, null, 2));
    } else {
        console.log("Query succeeded.");
        console.log(keyText);
        data.Items.forEach(function(item) {
            console.log(item.attText + " " + item.attribute1);
            document.getElementById("QueryResults").innerHTML = "Data: " + item.Model + " " + item.Make +"Amount of CEL codes per year" + item.CELNumbers;
        });
    }
    
});
}
        
        
        

        
window.fbAsyncInit = function () {
    FB.init({ appId: appId });

    document.getElementById('login').onclick = function () {

        FB.login(function (response) {
            if (response.authResponse) {
                AWS.config.credentials = new AWS.WebIdentityCredentials({ //WIF
                    RoleArn: roleArn,
                    ProviderId: 'graph.facebook.com',
                    WebIdentityToken: response.authResponse.accessToken
                });
                
          var url = '/me?fields=name,email';
         
           FB.api(url, function(response) {
                      

     });
            }
            else {
                console.log("Issue logging in");
            }

            // Load the FB JS SDK asynchronously
            (function (d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) { return; }
                js = d.createElement(s); js.id = id;
                js.src = "https://connect.facebook.net/en_US/all.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));
        
    
     dynamodb = new AWS.DynamoDB({ region: 'us-west-2' });
 docClient = new AWS.DynamoDB.DocumentClient({ service: dynamodb });
   params = {
    TableName: 'cleverTable',
    Key: { 
    "itemID": "12345"
},
       ExpressionAttributeValues: {
                    ':increment_by': 1,
                    ':now': sessionid
                    
    },
    UpdateExpression: 'SET loginBtn = loginBtn + :increment_by,' +'LastVisited = :now',
     
   };
          
       docClient.update(params, function (err, data) {
        if (err) console.log(err);
        else console.log(data);
        
    })
       
}, { scope: 'email' }
                 )
        }
    }

</script>
            </footer> <!-- /#footer -->
        
    </body>
</html>